2026/01/09 10:08:21 üìÅ Loaded .env from ../../../../.env for tests
=== RUN   TestFlowExecutor_PasswordHashing
2026/01/09 10:08:21 ‚úÖ FlowExecutor: Registered handlers for 3 supported events
=== RUN   TestFlowExecutor_PasswordHashing/Should_hash_password_on_beforeCreate
2026/01/09 10:08:21 üîç FlowExecutor: checking 1 flows for trigger 'beforeCreate' on object '_System_User'
2026/01/09 10:08:21 üîÑ Flow Test_Password_Hash: executing UpdateRecord action on _System_User
2026/01/09 10:08:21 ‚úÖ Flow Test_Password_Hash: executed successfully
2026/01/09 10:08:21 Verified: SecurePass123! -> $2a$10$hTkIeJtXLHtGjpuSrE3YluDxE1MmKRrM45YmM7apN49mx6ioCk.ry
--- PASS: TestFlowExecutor_PasswordHashing (0.11s)
    --- PASS: TestFlowExecutor_PasswordHashing/Should_hash_password_on_beforeCreate (0.11s)
=== RUN   TestFlowExecutor_HighPriorityAlert
2026/01/09 10:08:21 ‚úÖ FlowExecutor: Registered handlers for 3 supported events
=== RUN   TestFlowExecutor_HighPriorityAlert/Should_Trigger_Alert_on_High_Priority
2026/01/09 10:08:21 üîç FlowExecutor: checking 1 flows for trigger 'afterCreate' on object 'Ticket'
2026/01/09 10:08:21 üîÑ Flow High Priority Alert: executing CreateRecord action on Ticket
2026/01/09 10:08:21 ‚úÖ Flow High Priority Alert: executed successfully
=== RUN   TestFlowExecutor_HighPriorityAlert/Should_NOT_Trigger_Alert_on_Low_Priority
2026/01/09 10:08:21 üîç FlowExecutor: checking 1 flows for trigger 'afterCreate' on object 'Ticket'
--- PASS: TestFlowExecutor_HighPriorityAlert (0.00s)
    --- PASS: TestFlowExecutor_HighPriorityAlert/Should_Trigger_Alert_on_High_Priority (0.00s)
    --- PASS: TestFlowExecutor_HighPriorityAlert/Should_NOT_Trigger_Alert_on_Low_Priority (0.00s)
=== RUN   TestMasterDetail_CascadeDelete
2026/01/09 10:08:21 Warning: Failed to load role hierarchy: failed to query roles: Error 1146 (42S02): Table 'test._System_Role' doesn't exist
2026/01/09 10:08:21 üìê Creating table: project_1767924501342625000
2026/01/09 10:08:21 üìù Executing DDL for project_1767924501342625000: 
CREATE TABLE IF NOT EXISTS `project_1767924501342625000` (
  `__sys_gen_id` VARCHAR(36) NOT NULL PRIMARY KEY,
  `name` VARCHAR(255) NOT NULL,
  `__sys_gen_owner_id` VARCHAR(36),
  `__sys_gen_created_by_id` VARCHAR(36),
  `__sys_gen_last_modified_by_id` VARCHAR(36),
  `__sys_gen_created_date` DATETIME NOT NULL,
  `__sys_gen_last_modified_date` DATETIME NOT NULL,
  `__sys_gen_is_deleted` TINYINT(1) NOT NULL DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
2026/01/09 10:08:21 ‚úÖ DDL executed successfully for project_1767924501342625000
2026/01/09 10:08:21 ‚ö†Ô∏è An error occurred during registration. Rolling back table creation: project_1767924501342625000
    master_detail_test.go:85: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/master_detail_test.go:85
        	Error:      	Received unexpected error:
        	            	failed to register table project_1767924501342625000: Error 1146 (42S02): Table 'test._System_Table' doesn't exist
        	Test:       	TestMasterDetail_CascadeDelete
--- FAIL: TestMasterDetail_CascadeDelete (0.11s)
=== RUN   TestMetadataService_Apps_IsDefault
=== RUN   TestMetadataService_Apps_IsDefault/Create_App_With_Default
    metadata_apps_test.go:41: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_apps_test.go:41
        	Error:      	Received unexpected error:
        	            	failed to check app existence: Error 1146 (42S02): Table 'test._System_App' doesn't exist
        	Test:       	TestMetadataService_Apps_IsDefault/Create_App_With_Default
=== RUN   TestMetadataService_Apps_IsDefault/Update_App_To_Default
    metadata_apps_test.go:60: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_apps_test.go:60
        	Error:      	Received unexpected error:
        	            	failed to check app existence: Error 1146 (42S02): Table 'test._System_App' doesn't exist
        	Test:       	TestMetadataService_Apps_IsDefault/Update_App_To_Default
--- FAIL: TestMetadataService_Apps_IsDefault (0.00s)
    --- FAIL: TestMetadataService_Apps_IsDefault/Create_App_With_Default (0.00s)
    --- FAIL: TestMetadataService_Apps_IsDefault/Update_App_To_Default (0.00s)
=== RUN   TestMetadataService_Objects_ThemeColor_Integration
2026/01/09 10:08:21 üìê Creating table: color_test_1767924501459193000
2026/01/09 10:08:21 üìù Executing DDL for color_test_1767924501459193000: 
CREATE TABLE IF NOT EXISTS `color_test_1767924501459193000` (
  `__sys_gen_id` VARCHAR(36) PRIMARY KEY,
  `__sys_gen_owner_id` VARCHAR(36),
  `__sys_gen_created_by_id` VARCHAR(36),
  `__sys_gen_last_modified_by_id` VARCHAR(36),
  `__sys_gen_created_date` DATETIME,
  `__sys_gen_last_modified_date` DATETIME,
  `__sys_gen_is_deleted` BOOLEAN,
  `name` VARCHAR(255)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
2026/01/09 10:08:21 ‚úÖ DDL executed successfully for color_test_1767924501459193000
2026/01/09 10:08:21 ‚ö†Ô∏è An error occurred during registration. Rolling back table creation: color_test_1767924501459193000
    metadata_objects_test.go:47: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_objects_test.go:47
        	Error:      	Received unexpected error:
        	            	failed to create schema: failed to register table color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_Table' doesn't exist
        	Test:       	TestMetadataService_Objects_ThemeColor_Integration
    metadata_objects_test.go:56: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_objects_test.go:56
        	Error:      	Received unexpected error:
        	            	Error 1146 (42S02): Table 'test._System_Object' doesn't exist
        	Test:       	TestMetadataService_Objects_ThemeColor_Integration
    metadata_objects_test.go:57: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_objects_test.go:57
        	Error:      	Not equal: 
        	            	expected: "#123456"
        	            	actual  : ""
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-#123456
        	            	+
        	Test:       	TestMetadataService_Objects_ThemeColor_Integration
        	Messages:   	Theme color should be persisted correctly
2026/01/09 10:08:21 üî• Dropping table: color_test_1767924501459193000
2026/01/09 10:08:21 ‚ö†Ô∏è  Warning: Failed to unregister table color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_Table' doesn't exist
2026/01/09 10:08:21 ‚ö†Ô∏è  Warning: Failed to delete fields for object color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_Field' doesn't exist
2026/01/09 10:08:21 ‚ö†Ô∏è  Warning: Failed to delete object metadata color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_Object' doesn't exist
2026/01/09 10:08:21 ‚ö†Ô∏è  Warning: Failed to delete auto-number metadata for color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_AutoNumber' doesn't exist
2026/01/09 10:08:21 ‚ö†Ô∏è  Warning: Failed to delete object permissions for color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_ObjectPerms' doesn't exist
2026/01/09 10:08:21 ‚ö†Ô∏è  Warning: Failed to delete field permissions for color_test_1767924501459193000: Error 1146 (42S02): Table 'test._System_FieldPerms' doesn't exist
2026/01/09 10:08:21    ‚úÖ Table dropped and metadata cleaned: color_test_1767924501459193000
--- FAIL: TestMetadataService_Objects_ThemeColor_Integration (0.11s)
=== RUN   TestMetadataService_Themes_Integration
    metadata_themes_test.go:60: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:60
        	Error:      	Received unexpected error:
        	            	failed to check theme existence: Error 1146 (42S02): Table 'test._System_Theme' doesn't exist
        	Test:       	TestMetadataService_Themes_Integration
    metadata_themes_test.go:65: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:65
        	Error:      	Received unexpected error:
        	            	Error 1146 (42S02): Table 'test._System_Theme' doesn't exist
        	Test:       	TestMetadataService_Themes_Integration
    metadata_themes_test.go:70: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:70
        	Error:      	Received unexpected error:
        	            	Error 1146 (42S02): Table 'test._System_Theme' doesn't exist
        	Test:       	TestMetadataService_Themes_Integration
    metadata_themes_test.go:74: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:74
        	Error:      	Received unexpected error:
        	            	failed to deactivate themes: Error 1146 (42S02): Table 'test._System_Theme' doesn't exist
        	Test:       	TestMetadataService_Themes_Integration
    metadata_themes_test.go:78: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:78
        	Error:      	Received unexpected error:
        	            	Error 1146 (42S02): Table 'test._System_Theme' doesn't exist
        	Test:       	TestMetadataService_Themes_Integration
    metadata_themes_test.go:79: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:79
        	Error:      	Expected value not to be nil.
        	Test:       	TestMetadataService_Themes_Integration
--- FAIL: TestMetadataService_Themes_Integration (0.00s)
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
	panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x2 addr=0x8 pc=0x1006b0b20]

goroutine 44 [running]:
testing.tRunner.func1.2({0x10090d0e0, 0x101664860})
	/opt/homebrew/Cellar/go/1.24.3/libexec/src/testing/testing.go:1734 +0x1ac
testing.tRunner.func1()
	/opt/homebrew/Cellar/go/1.24.3/libexec/src/testing/testing.go:1737 +0x334
panic({0x10090d0e0?, 0x101664860?})
	/opt/homebrew/Cellar/go/1.24.3/libexec/src/runtime/panic.go:792 +0x124
github.com/nexuscrm/backend/internal/application/services.TestMetadataService_Themes_Integration(0x140001adc00)
	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/metadata_themes_test.go:80 +0x5e0
testing.tRunner(0x140001adc00, 0x1009d6c28)
	/opt/homebrew/Cellar/go/1.24.3/libexec/src/testing/testing.go:1792 +0xe4
created by testing.(*T).Run in goroutine 1
	/opt/homebrew/Cellar/go/1.24.3/libexec/src/testing/testing.go:1851 +0x374
FAIL	github.com/nexuscrm/backend/internal/application/services	1.072s
FAIL
