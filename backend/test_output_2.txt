2026/01/07 11:27:29 üìÅ Loaded .env from ../../../../.env for tests
=== RUN   TestFlowExecutor_PasswordHashing
2026/01/07 11:27:29 ‚úÖ FlowExecutor: Registered handlers for 3 supported events
=== RUN   TestFlowExecutor_PasswordHashing/Should_hash_password_on_beforeCreate
2026/01/07 11:27:29 üîç FlowExecutor: checking 1 flows for trigger 'beforeCreate' on object '_System_User'
2026/01/07 11:27:29 üîÑ Flow Test_Password_Hash: executing UpdateRecord action on _System_User
2026/01/07 11:27:29 ‚úÖ Flow Test_Password_Hash: executed successfully
2026/01/07 11:27:29 Verified: SecurePass123! -> $2a$10$drZ27g5TFMeMt5grRF45y.0fJZ.RjOpQj09DbQOMOzGM5M4NNuyRi
--- PASS: TestFlowExecutor_PasswordHashing (0.10s)
    --- PASS: TestFlowExecutor_PasswordHashing/Should_hash_password_on_beforeCreate (0.10s)
=== RUN   TestFlowExecutor_HighPriorityAlert
2026/01/07 11:27:29 ‚úÖ FlowExecutor: Registered handlers for 3 supported events
=== RUN   TestFlowExecutor_HighPriorityAlert/Should_Trigger_Alert_on_High_Priority
2026/01/07 11:27:29 üîç FlowExecutor: checking 1 flows for trigger 'afterCreate' on object 'Ticket'
2026/01/07 11:27:29 üîÑ Flow High Priority Alert: executing CreateRecord action on Ticket
2026/01/07 11:27:29 ‚úÖ Flow High Priority Alert: executed successfully
=== RUN   TestFlowExecutor_HighPriorityAlert/Should_NOT_Trigger_Alert_on_Low_Priority
2026/01/07 11:27:29 üîç FlowExecutor: checking 1 flows for trigger 'afterCreate' on object 'Ticket'
--- PASS: TestFlowExecutor_HighPriorityAlert (0.00s)
    --- PASS: TestFlowExecutor_HighPriorityAlert/Should_Trigger_Alert_on_High_Priority (0.00s)
    --- PASS: TestFlowExecutor_HighPriorityAlert/Should_NOT_Trigger_Alert_on_Low_Priority (0.00s)
=== RUN   TestMasterDetail_CascadeDelete
2026/01/07 11:27:29 üìê Creating table: project_1767756449557522000
2026/01/07 11:27:29 üìù Executing DDL for project_1767756449557522000
2026/01/07 11:27:29 ‚úÖ DDL executed successfully for project_1767756449557522000
2026/01/07 11:27:29    ‚úÖ Table created and registered (strict): project_1767756449557522000
2026/01/07 11:27:29 üìê Creating table: task_1767756449595228000
2026/01/07 11:27:29 üìù Executing DDL for task_1767756449595228000
2026/01/07 11:27:29 ‚úÖ DDL executed successfully for task_1767756449595228000
2026/01/07 11:27:29    ‚úÖ Table created and registered (strict): task_1767756449595228000
2026/01/07 11:27:29 üîÑ Refreshing metadata cache...
2026/01/07 11:27:29 ‚úÖ Metadata cache refreshed: 79 objects loaded
2026/01/07 11:27:29 ‚ú® Created record 9ea480a2-ffe2-4893-94a0-f36f27033ccf in project_1767756449557522000 (User: test-admin)
2026/01/07 11:27:29 ‚ú® Created record 7d603f5f-e977-478f-8377-3bb4dfd6e4bf in task_1767756449595228000 (User: test-admin)
    master_detail_test.go:147: Deleting Parent Project...
2026/01/07 11:27:29 üóëÔ∏è Deleted record 9ea480a2-ffe2-4893-94a0-f36f27033ccf in project_1767756449557522000 (User: test-admin)
    master_detail_test.go:163: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/master_detail_test.go:163
        	Error:      	Should be true
        	Test:       	TestMasterDetail_CascadeDelete
        	Messages:   	Child should be soft deleted (Cascade)
2026/01/07 11:27:29 üî• Dropping table: task_1767756449595228000
2026/01/07 11:27:29    ‚úÖ Table dropped and metadata cleaned: task_1767756449595228000
2026/01/07 11:27:29 üî• Dropping table: project_1767756449557522000
2026/01/07 11:27:29    ‚úÖ Table dropped and metadata cleaned: project_1767756449557522000
--- FAIL: TestMasterDetail_CascadeDelete (0.25s)
=== RUN   TestMetadataService_Apps_IsDefault
=== RUN   TestMetadataService_Apps_IsDefault/Create_App_With_Default
=== RUN   TestMetadataService_Apps_IsDefault/Update_App_To_Default
--- PASS: TestMetadataService_Apps_IsDefault (0.00s)
    --- PASS: TestMetadataService_Apps_IsDefault/Create_App_With_Default (0.00s)
    --- PASS: TestMetadataService_Apps_IsDefault/Update_App_To_Default (0.00s)
=== RUN   TestMetadataService_Objects_ThemeColor_Integration
2026/01/07 11:27:29 üìê Creating table: color_test_1767756449806503000
2026/01/07 11:27:29 üìù Executing DDL for color_test_1767756449806503000
2026/01/07 11:27:29 ‚úÖ DDL executed successfully for color_test_1767756449806503000
2026/01/07 11:27:29    ‚úÖ Table created and registered (strict): color_test_1767756449806503000
2026/01/07 11:27:29 üóëÔ∏è Metadata cache invalidated
2026/01/07 11:27:29 üî• Dropping table: color_test_1767756449806503000
2026/01/07 11:27:29    ‚úÖ Table dropped and metadata cleaned: color_test_1767756449806503000
--- PASS: TestMetadataService_Objects_ThemeColor_Integration (0.11s)
=== RUN   TestMetadataService_Themes_Integration
2026/01/07 11:27:29 ‚úÖ Theme activated: c273ce5d-6035-4ebb-acf9-a97f70ff23e4
--- PASS: TestMetadataService_Themes_Integration (0.00s)
=== RUN   TestCheckObjectPermissionWithUser_NilUser
--- PASS: TestCheckObjectPermissionWithUser_NilUser (0.00s)
=== RUN   TestCheckObjectPermissionWithUser_SuperUser
--- PASS: TestCheckObjectPermissionWithUser_SuperUser (0.00s)
=== RUN   TestCheckFieldEditabilityWithUser_SystemField
--- PASS: TestCheckFieldEditabilityWithUser_SystemField (0.00s)
=== RUN   TestCheckFieldVisibilityWithUser_NilUser
--- PASS: TestCheckFieldVisibilityWithUser_NilUser (0.00s)
=== RUN   TestCheckFieldVisibilityWithUser_SuperUser
--- PASS: TestCheckFieldVisibilityWithUser_SuperUser (0.00s)
=== RUN   TestCheckPermissionOrErrorWithUser_NilUser
--- PASS: TestCheckPermissionOrErrorWithUser_NilUser (0.00s)
=== RUN   TestCheckPermissionOrErrorWithUser_SuperUser
--- PASS: TestCheckPermissionOrErrorWithUser_SuperUser (0.00s)
=== RUN   TestGetEffectiveSchema_NilSchema
--- PASS: TestGetEffectiveSchema_NilSchema (0.00s)
=== RUN   TestGetEffectiveSchema_SuperUser
--- PASS: TestGetEffectiveSchema_SuperUser (0.00s)
=== RUN   TestGetEffectiveSchema_NilUser
--- PASS: TestGetEffectiveSchema_NilUser (0.00s)
=== RUN   TestCheckRecordAccess_Owner
--- PASS: TestCheckRecordAccess_Owner (0.00s)
=== RUN   TestCheckRecordAccess_NonOwner
--- PASS: TestCheckRecordAccess_NonOwner (0.00s)
=== RUN   TestCheckRecordAccess_SuperUser
--- PASS: TestCheckRecordAccess_SuperUser (0.00s)
=== RUN   TestCheckRecordAccess_NoOwnerField
--- PASS: TestCheckRecordAccess_NoOwnerField (0.00s)
=== RUN   TestCheckRecordAccess_PointerOwner
--- PASS: TestCheckRecordAccess_PointerOwner (0.00s)
=== RUN   TestRollupSummary_Sum
2026/01/07 11:27:29 üìê Creating table: invoice_1767756449919623000
2026/01/07 11:27:29 üìù Executing DDL for invoice_1767756449919623000
2026/01/07 11:27:29 ‚úÖ DDL executed successfully for invoice_1767756449919623000
2026/01/07 11:27:29    ‚úÖ Table created and registered (strict): invoice_1767756449919623000
2026/01/07 11:27:29 üìê Creating table: line_item_1767756449952101000
2026/01/07 11:27:29 üìù Executing DDL for line_item_1767756449952101000
2026/01/07 11:27:29 ‚úÖ DDL executed successfully for line_item_1767756449952101000
2026/01/07 11:27:29    ‚úÖ Table created and registered (strict): line_item_1767756449952101000
2026/01/07 11:27:29 üîÑ Refreshing metadata cache...
2026/01/07 11:27:29 ‚úÖ Metadata cache refreshed: 79 objects loaded
2026/01/07 11:27:30 ‚ú® Created record 5c61b9b2-4ae9-4125-904d-ab0601582171 in invoice_1767756449919623000 (User: test-admin)
2026/01/07 11:27:30 ‚ú® Created record 97cd6801-998c-4fbd-86a1-bafb6a28f469 in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:176
        	Error:      	Not equal: 
        	            	expected: 100
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 ‚ú® Created record 1438dc40-cc5e-4da6-a0b7-b8b5691814c6 in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:182
        	Error:      	Not equal: 
        	            	expected: 150
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 ‚ú® Created record d151d688-b815-4304-bab6-037b7a9d3f78 in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:188
        	Error:      	Not equal: 
        	            	expected: 175
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 üìù Updated record d151d688-b815-4304-bab6-037b7a9d3f78 in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:193
        	Error:      	Not equal: 
        	            	expected: 275
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 üóëÔ∏è Deleted record d151d688-b815-4304-bab6-037b7a9d3f78 in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:198
        	Error:      	Not equal: 
        	            	expected: 150
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 ‚ú® Created record b369ee16-e02f-4608-95a3-e60b85ceb943 in invoice_1767756449919623000 (User: test-admin)
2026/01/07 11:27:30 ‚ú® Created record 75ae13e7-b9d5-42e6-bae7-39ee5864d4ae in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:224
        	Error:      	Not equal: 
        	            	expected: 225
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 üìù Updated record 75ae13e7-b9d5-42e6-bae7-39ee5864d4ae in line_item_1767756449952101000 (User: test-admin)
    rollup_test.go:211: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:211
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:231
        	Error:      	Not equal: 
        	            	expected: 75
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
    rollup_test.go:168: 
        	Error Trace:	/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:168
        	            				/Users/qiliu/projects/nexuscrm/backend/internal/application/services/rollup_test.go:234
        	Error:      	Not equal: 
        	            	expected: 150
        	            	actual  : 0
        	Test:       	TestRollupSummary_Sum
2026/01/07 11:27:30 üî• Dropping table: line_item_1767756449952101000
2026/01/07 11:27:30    ‚úÖ Table dropped and metadata cleaned: line_item_1767756449952101000
2026/01/07 11:27:30 üî• Dropping table: invoice_1767756449919623000
2026/01/07 11:27:30    ‚úÖ Table dropped and metadata cleaned: invoice_1767756449919623000
--- FAIL: TestRollupSummary_Sum (0.25s)
=== RUN   TestSchemaManager_Integration_ACID
    schema_manager_integration_test.go:57: Creating table test_acid_obj_1767756450169568000...
2026/01/07 11:27:30 üìê Creating table: test_acid_obj_1767756450169568000
2026/01/07 11:27:30 üìù Executing DDL for test_acid_obj_1767756450169568000
2026/01/07 11:27:30 ‚úÖ DDL executed successfully for test_acid_obj_1767756450169568000
2026/01/07 11:27:30    ‚úÖ Table created and registered (strict): test_acid_obj_1767756450169568000
    schema_manager_integration_test.go:111: ‚úÖ Integration Test Passed: Table and Metadata created correctly.
2026/01/07 11:27:30 üî• Dropping table: test_acid_obj_1767756450169568000
2026/01/07 11:27:30    ‚úÖ Table dropped and metadata cleaned: test_acid_obj_1767756450169568000
--- PASS: TestSchemaManager_Integration_ACID (0.11s)
=== RUN   TestValidationService_ValidateRecord
=== RUN   TestValidationService_ValidateRecord/Valid_Record
=== RUN   TestValidationService_ValidateRecord/Missing_Required
=== RUN   TestValidationService_ValidateRecord/Too_Young
=== RUN   TestValidationService_ValidateRecord/Invalid_Regex
=== RUN   TestValidationService_ValidateRecord/Validation_Rule_Failure
--- PASS: TestValidationService_ValidateRecord (0.00s)
    --- PASS: TestValidationService_ValidateRecord/Valid_Record (0.00s)
    --- PASS: TestValidationService_ValidateRecord/Missing_Required (0.00s)
    --- PASS: TestValidationService_ValidateRecord/Too_Young (0.00s)
    --- PASS: TestValidationService_ValidateRecord/Invalid_Regex (0.00s)
    --- PASS: TestValidationService_ValidateRecord/Validation_Rule_Failure (0.00s)
=== RUN   TestValidationService_NullKeyword
=== RUN   TestValidationService_NullKeyword/Null_keyword_works_with_nil_value
=== RUN   TestValidationService_NullKeyword/Null_keyword_works_with_present_value
=== RUN   TestValidationService_NullKeyword/Not_null_check_works
--- PASS: TestValidationService_NullKeyword (0.00s)
    --- PASS: TestValidationService_NullKeyword/Null_keyword_works_with_nil_value (0.00s)
    --- PASS: TestValidationService_NullKeyword/Null_keyword_works_with_present_value (0.00s)
    --- PASS: TestValidationService_NullKeyword/Not_null_check_works (0.00s)
=== RUN   TestValidationService_EmptyStringNormalization
=== RUN   TestValidationService_EmptyStringNormalization/Empty_date_string_treated_as_null
=== RUN   TestValidationService_EmptyStringNormalization/Empty_number_string_treated_as_null
=== RUN   TestValidationService_EmptyStringNormalization/Empty_text_string_NOT_treated_as_null_(preserved)
--- PASS: TestValidationService_EmptyStringNormalization (0.00s)
    --- PASS: TestValidationService_EmptyStringNormalization/Empty_date_string_treated_as_null (0.00s)
    --- PASS: TestValidationService_EmptyStringNormalization/Empty_number_string_treated_as_null (0.00s)
    --- PASS: TestValidationService_EmptyStringNormalization/Empty_text_string_NOT_treated_as_null_(preserved) (0.00s)
=== RUN   TestValidationService_FailClosed
=== RUN   TestValidationService_FailClosed/Syntax_error_causes_internal_error
=== RUN   TestValidationService_FailClosed/Inactive_rules_are_skipped_even_with_bad_syntax
=== RUN   TestValidationService_FailClosed/Valid_rule_that_passes
=== RUN   TestValidationService_FailClosed/Valid_rule_that_triggers
--- PASS: TestValidationService_FailClosed (0.00s)
    --- PASS: TestValidationService_FailClosed/Syntax_error_causes_internal_error (0.00s)
    --- PASS: TestValidationService_FailClosed/Inactive_rules_are_skipped_even_with_bad_syntax (0.00s)
    --- PASS: TestValidationService_FailClosed/Valid_rule_that_passes (0.00s)
    --- PASS: TestValidationService_FailClosed/Valid_rule_that_triggers (0.00s)
=== RUN   TestValidationService_ValidateFlow
=== RUN   TestValidationService_ValidateFlow/Allow_different_trigger_type
=== RUN   TestValidationService_ValidateFlow/Allow_different_object
=== RUN   TestValidationService_ValidateFlow/Deny_duplicate_trigger
=== RUN   TestValidationService_ValidateFlow/Allow_self_update
=== RUN   TestValidationService_ValidateFlow/Allow_duplicate_if_inactive
--- PASS: TestValidationService_ValidateFlow (0.00s)
    --- PASS: TestValidationService_ValidateFlow/Allow_different_trigger_type (0.00s)
    --- PASS: TestValidationService_ValidateFlow/Allow_different_object (0.00s)
    --- PASS: TestValidationService_ValidateFlow/Deny_duplicate_trigger (0.00s)
    --- PASS: TestValidationService_ValidateFlow/Allow_self_update (0.00s)
    --- PASS: TestValidationService_ValidateFlow/Allow_duplicate_if_inactive (0.00s)
=== RUN   TestValidationService_Naming
=== RUN   TestValidationService_Naming/Object_Valid
=== RUN   TestValidationService_Naming/Field_Valid
=== RUN   TestValidationService_Naming/Object_CamelCase
=== RUN   TestValidationService_Naming/Field_CamelCase
=== RUN   TestValidationService_Naming/Object_Spaces
=== RUN   TestValidationService_Naming/Field_Spaces
=== RUN   TestValidationService_Naming/Object_Dashes
=== RUN   TestValidationService_Naming/Field_Dashes
=== RUN   TestValidationService_Naming/Object_StartNum
=== RUN   TestValidationService_Naming/Field_StartNum
--- PASS: TestValidationService_Naming (0.00s)
    --- PASS: TestValidationService_Naming/Object_Valid (0.00s)
    --- PASS: TestValidationService_Naming/Field_Valid (0.00s)
    --- PASS: TestValidationService_Naming/Object_CamelCase (0.00s)
    --- PASS: TestValidationService_Naming/Field_CamelCase (0.00s)
    --- PASS: TestValidationService_Naming/Object_Spaces (0.00s)
    --- PASS: TestValidationService_Naming/Field_Spaces (0.00s)
    --- PASS: TestValidationService_Naming/Object_Dashes (0.00s)
    --- PASS: TestValidationService_Naming/Field_Dashes (0.00s)
    --- PASS: TestValidationService_Naming/Object_StartNum (0.00s)
    --- PASS: TestValidationService_Naming/Field_StartNum (0.00s)
=== RUN   TestFormulaFields_Integration
2026/01/07 11:27:30 üìê Creating table: product_1767756450281344000
2026/01/07 11:27:30 üìù Executing DDL for product_1767756450281344000
2026/01/07 11:27:30 ‚úÖ DDL executed successfully for product_1767756450281344000
2026/01/07 11:27:30    ‚úÖ Table created and registered (strict): product_1767756450281344000
2026/01/07 11:27:30 ‚úÖ Auto-created default layout for product_1767756450281344000
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
2026/01/07 11:27:30 ‚ûï Adding column price to table product_1767756450281344000
2026/01/07 11:27:30    üèÅ Executing DDL: ALTER TABLE `product_1767756450281344000` ADD COLUMN `price` VARCHAR(255)
2026/01/07 11:27:30    ‚úÖ DDL execution complete
2026/01/07 11:27:30    ‚úÖ Column added/registered: product_1767756450281344000.price
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
2026/01/07 11:27:30 ‚ûï Adding column quantity to table product_1767756450281344000
2026/01/07 11:27:30    üèÅ Executing DDL: ALTER TABLE `product_1767756450281344000` ADD COLUMN `quantity` VARCHAR(255)
2026/01/07 11:27:30    ‚úÖ DDL execution complete
2026/01/07 11:27:30    ‚úÖ Column added/registered: product_1767756450281344000.quantity
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
2026/01/07 11:27:30 ‚ûï Adding column total to table product_1767756450281344000
2026/01/07 11:27:30    üèÅ Executing DDL: ALTER TABLE `product_1767756450281344000` ADD COLUMN `total` DECIMAL(18,6) GENERATED ALWAYS AS (price * quantity) VIRTUAL
2026/01/07 11:27:30    ‚úÖ DDL execution complete
2026/01/07 11:27:30    ‚úÖ Column added/registered: product_1767756450281344000.total
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
2026/01/07 11:27:30 üîÑ Refreshing metadata cache...
2026/01/07 11:27:30 ‚úÖ Metadata cache refreshed: 78 objects loaded
2026/01/07 11:27:30 ‚ú® Created record d987a797-1548-43ea-b6f9-be417c5fd811 in product_1767756450281344000 (User: admin-user)
=== RUN   TestFormulaFields_Integration/Read-Time_Calculation
=== RUN   TestFormulaFields_Integration/Filter_by_Formula_(Match)
=== RUN   TestFormulaFields_Integration/Filter_by_Formula_(No_Match)
=== RUN   TestFormulaFields_Integration/Verify_Generated_Column_Schema
    formula_integration_test.go:180: ‚úÖ Generated column expression: `price` * `quantity`
=== RUN   TestFormulaFields_Integration/Update_Propagation
2026/01/07 11:27:30 üìù Updated record d987a797-1548-43ea-b6f9-be417c5fd811 in product_1767756450281344000 (User: admin-user)
=== RUN   TestFormulaFields_Integration/Null_Value_Handling
2026/01/07 11:27:30 ‚ú® Created record 6b42f6e3-8f2f-4952-89e6-7899395a8a02 in product_1767756450281344000 (User: admin-user)
2026/01/07 11:27:30 ‚ö†Ô∏è Formula evaluation error on field 'total': invalid operation: <nil> * float64 (1:7)
 | price * quantity
 | ......^
    formula_integration_test.go:255: Total with null price: <nil> (type <nil>) - Expected nil
--- PASS: TestFormulaFields_Integration (0.33s)
    --- PASS: TestFormulaFields_Integration/Read-Time_Calculation (0.00s)
    --- PASS: TestFormulaFields_Integration/Filter_by_Formula_(Match) (0.00s)
    --- PASS: TestFormulaFields_Integration/Filter_by_Formula_(No_Match) (0.00s)
    --- PASS: TestFormulaFields_Integration/Verify_Generated_Column_Schema (0.00s)
    --- PASS: TestFormulaFields_Integration/Update_Propagation (0.00s)
    --- PASS: TestFormulaFields_Integration/Null_Value_Handling (0.00s)
=== RUN   TestFormulaValidation
2026/01/07 11:27:30 üìê Creating table: formula_validation_1767756450615585000
2026/01/07 11:27:30 üìù Executing DDL for formula_validation_1767756450615585000
2026/01/07 11:27:30 ‚úÖ DDL executed successfully for formula_validation_1767756450615585000
2026/01/07 11:27:30    ‚úÖ Table created and registered (strict): formula_validation_1767756450615585000
2026/01/07 11:27:30 ‚úÖ Auto-created default layout for formula_validation_1767756450615585000
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
2026/01/07 11:27:30 ‚ûï Adding column amount to table formula_validation_1767756450615585000
2026/01/07 11:27:30    üèÅ Executing DDL: ALTER TABLE `formula_validation_1767756450615585000` ADD COLUMN `amount` VARCHAR(255)
2026/01/07 11:27:30    ‚úÖ DDL execution complete
2026/01/07 11:27:30    ‚úÖ Column added/registered: formula_validation_1767756450615585000.amount
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
=== RUN   TestFormulaValidation/Valid_Formula_Syntax
2026/01/07 11:27:30 ‚ûï Adding column tax_amount to table formula_validation_1767756450615585000
2026/01/07 11:27:30    üèÅ Executing DDL: ALTER TABLE `formula_validation_1767756450615585000` ADD COLUMN `tax_amount` DECIMAL(18,6) GENERATED ALWAYS AS (amount * 1.1) VIRTUAL
2026/01/07 11:27:30    ‚úÖ DDL execution complete
2026/01/07 11:27:30    ‚úÖ Column added/registered: formula_validation_1767756450615585000.tax_amount
2026/01/07 11:27:30 üóëÔ∏è Metadata cache invalidated
    formula_integration_test.go:309: ‚úÖ Valid formula syntax accepted
=== RUN   TestFormulaValidation/Invalid_Formula_Syntax_-_Parse_Error
    formula_integration_test.go:327: ‚úÖ Invalid formula correctly rejected: validation error on field 'formula': Invalid formula syntax: unexpected token Operator("*") (1:10)
         | amount * * 1.1
         | .........^
=== RUN   TestFormulaValidation/Empty_Formula_Expression
    formula_integration_test.go:345: ‚úÖ Empty formula correctly rejected: validation error on field 'formula': Formula fields require a formula expression
=== RUN   TestFormulaValidation/Nil_Formula_Expression
    formula_integration_test.go:362: ‚úÖ Nil formula correctly rejected: validation error on field 'formula': Formula fields require a formula expression
--- PASS: TestFormulaValidation (0.21s)
    --- PASS: TestFormulaValidation/Valid_Formula_Syntax (0.08s)
    --- PASS: TestFormulaValidation/Invalid_Formula_Syntax_-_Parse_Error (0.00s)
    --- PASS: TestFormulaValidation/Empty_Formula_Expression (0.00s)
    --- PASS: TestFormulaValidation/Nil_Formula_Expression (0.00s)
=== RUN   TestFormulaFilter_ToSQL
=== RUN   TestFormulaFilter_ToSQL/Simple_equality
    query_filter_test.go:115: ‚úÖ Filter 'status == 'Open'' -> SQL '(status = ?)' with 1 args
=== RUN   TestFormulaFilter_ToSQL/Greater_than
    query_filter_test.go:115: ‚úÖ Filter 'amount > 1000' -> SQL '(amount > ?)' with 1 args
=== RUN   TestFormulaFilter_ToSQL/Less_than_or_equal
    query_filter_test.go:115: ‚úÖ Filter 'price <= 50.5' -> SQL '(price <= ?)' with 1 args
=== RUN   TestFormulaFilter_ToSQL/Not_equal
    query_filter_test.go:115: ‚úÖ Filter 'type != 'Cancelled'' -> SQL '(type != ?)' with 1 args
=== RUN   TestFormulaFilter_ToSQL/AND_condition
    query_filter_test.go:115: ‚úÖ Filter 'status == 'Open' && amount > 500' -> SQL '((status = ?) AND (amount > ?))' with 2 args
=== RUN   TestFormulaFilter_ToSQL/OR_condition
    query_filter_test.go:115: ‚úÖ Filter 'type == 'A' || type == 'B'' -> SQL '((type = ?) OR (type = ?))' with 2 args
=== RUN   TestFormulaFilter_ToSQL/CONTAINS_function
    query_filter_test.go:115: ‚úÖ Filter 'CONTAINS(name, 'Acme')' -> SQL 'name LIKE ?' with 1 args
=== RUN   TestFormulaFilter_ToSQL/STARTS_WITH_function
    query_filter_test.go:115: ‚úÖ Filter 'STARTS_WITH(name, 'Test')' -> SQL 'name LIKE ?' with 1 args
=== RUN   TestFormulaFilter_ToSQL/ENDS_WITH_function
    query_filter_test.go:115: ‚úÖ Filter 'ENDS_WITH(email, '.com')' -> SQL 'email LIKE ?' with 1 args
=== RUN   TestFormulaFilter_ToSQL/Empty_filter
    query_filter_test.go:88: ‚úÖ Empty filter handled correctly
=== RUN   TestFormulaFilter_ToSQL/Invalid_syntax
    query_filter_test.go:98: ‚úÖ Invalid syntax correctly rejected: failed to parse expression: unexpected token Operator("==") (1:11)
         | status == == 'Open'
         | ..........^
--- PASS: TestFormulaFilter_ToSQL (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/Simple_equality (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/Greater_than (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/Less_than_or_equal (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/Not_equal (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/AND_condition (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/OR_condition (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/CONTAINS_function (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/STARTS_WITH_function (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/ENDS_WITH_function (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/Empty_filter (0.00s)
    --- PASS: TestFormulaFilter_ToSQL/Invalid_syntax (0.00s)
=== RUN   TestFormulaFilter_StringFunctions
=== RUN   TestFormulaFilter_StringFunctions/CONTAINS_pattern
    query_filter_test.go:137: ‚úÖ CONTAINS produces correct LIKE pattern: SQL='name LIKE ?', pattern='%Acme%'
=== RUN   TestFormulaFilter_StringFunctions/STARTS_WITH_pattern
    query_filter_test.go:156: ‚úÖ STARTS_WITH produces correct LIKE pattern: SQL='name LIKE ?', pattern='Test%'
=== RUN   TestFormulaFilter_StringFunctions/ENDS_WITH_pattern
    query_filter_test.go:175: ‚úÖ ENDS_WITH produces correct LIKE pattern: SQL='email LIKE ?', pattern='%.com'
--- PASS: TestFormulaFilter_StringFunctions (0.00s)
    --- PASS: TestFormulaFilter_StringFunctions/CONTAINS_pattern (0.00s)
    --- PASS: TestFormulaFilter_StringFunctions/STARTS_WITH_pattern (0.00s)
    --- PASS: TestFormulaFilter_StringFunctions/ENDS_WITH_pattern (0.00s)
=== RUN   TestRoleHierarchy_ManagerVisibility
=== RUN   TestRoleHierarchy_ManagerVisibility/Rep_can_access_own_record
=== RUN   TestRoleHierarchy_ManagerVisibility/Manager_can_read_subordinate_record
=== RUN   TestRoleHierarchy_ManagerVisibility/VP_can_read_subordinate_record_(2_levels_down)
=== RUN   TestRoleHierarchy_ManagerVisibility/CEO_can_read_any_subordinate_record
=== RUN   TestRoleHierarchy_ManagerVisibility/Rep_cannot_read_Manager_record
=== RUN   TestRoleHierarchy_ManagerVisibility/Sibling_cannot_read_peer_record
=== RUN   TestRoleHierarchy_ManagerVisibility/Manager_cannot_edit_subordinate_record_via_hierarchy
=== NAME  TestRoleHierarchy_ManagerVisibility
    role_hierarchy_test.go:199: ‚úÖ Role Hierarchy tests completed successfully
--- PASS: TestRoleHierarchy_ManagerVisibility (0.02s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/Rep_can_access_own_record (0.00s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/Manager_can_read_subordinate_record (0.00s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/VP_can_read_subordinate_record_(2_levels_down) (0.00s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/CEO_can_read_any_subordinate_record (0.00s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/Rep_cannot_read_Manager_record (0.00s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/Sibling_cannot_read_peer_record (0.00s)
    --- PASS: TestRoleHierarchy_ManagerVisibility/Manager_cannot_edit_subordinate_record_via_hierarchy (0.00s)
=== RUN   TestSharingRules_Integration
=== RUN   TestSharingRules_Integration/Sales_user_can_read_Tech_record_via_sharing_rule
=== RUN   TestSharingRules_Integration/Sales_user_cannot_read_Finance_record_(criteria_mismatch)
=== RUN   TestSharingRules_Integration/Marketing_user_cannot_read_Tech_record_(not_in_shared_role)
=== RUN   TestSharingRules_Integration/Sales_user_cannot_edit_Tech_record_(rule_is_Read_only)
=== RUN   TestSharingRules_Integration/Marketing_user_can_edit_any_Account_record_(Edit_access,_no_criteria)
=== NAME  TestSharingRules_Integration
    sharing_rules_test.go:171: ‚úÖ Sharing Rules tests completed successfully
--- PASS: TestSharingRules_Integration (0.02s)
    --- PASS: TestSharingRules_Integration/Sales_user_can_read_Tech_record_via_sharing_rule (0.00s)
    --- PASS: TestSharingRules_Integration/Sales_user_cannot_read_Finance_record_(criteria_mismatch) (0.00s)
    --- PASS: TestSharingRules_Integration/Marketing_user_cannot_read_Tech_record_(not_in_shared_role) (0.00s)
    --- PASS: TestSharingRules_Integration/Sales_user_cannot_edit_Tech_record_(rule_is_Read_only) (0.00s)
    --- PASS: TestSharingRules_Integration/Marketing_user_can_edit_any_Account_record_(Edit_access,_no_criteria) (0.00s)
=== RUN   TestValidationRule_DateComparison
    validation_date_test.go:49: Got expected past date error: validation error: Close Date cannot be in the past
--- PASS: TestValidationRule_DateComparison (0.00s)
=== RUN   TestValidationRule_MissingField
    validation_repro_test.go:52: Validation error (as expected?): validation error: Close Date required
--- PASS: TestValidationRule_MissingField (0.00s)
=== RUN   TestValidationRule_Malformed
    validation_repro_test.go:85: Got expected system error: internal error: Validation rule '' failed to evaluate (caused by: unknown name NON_EXISTENT_FUNC (1:1)
         | NON_EXISTENT_FUNC() == true
         | ^)
--- PASS: TestValidationRule_Malformed (0.00s)
=== RUN   TestValidationRule_EmptyStringSyntax
=== RUN   TestValidationRule_EmptyStringSyntax/Empty_String_Check_(==_"")
=== RUN   TestValidationRule_EmptyStringSyntax/Nil_Check_(==_nil)_with_String
=== RUN   TestValidationRule_EmptyStringSyntax/Nil_Check_(==_nil)_with_Nil
=== RUN   TestValidationRule_EmptyStringSyntax/Combined_Check
=== RUN   TestValidationRule_EmptyStringSyntax/Len_Check
--- PASS: TestValidationRule_EmptyStringSyntax (0.00s)
    --- PASS: TestValidationRule_EmptyStringSyntax/Empty_String_Check_(==_"") (0.00s)
    --- PASS: TestValidationRule_EmptyStringSyntax/Nil_Check_(==_nil)_with_String (0.00s)
    --- PASS: TestValidationRule_EmptyStringSyntax/Nil_Check_(==_nil)_with_Nil (0.00s)
    --- PASS: TestValidationRule_EmptyStringSyntax/Combined_Check (0.00s)
    --- PASS: TestValidationRule_EmptyStringSyntax/Len_Check (0.00s)
FAIL
FAIL	github.com/nexuscrm/backend/internal/application/services	1.764s
FAIL
